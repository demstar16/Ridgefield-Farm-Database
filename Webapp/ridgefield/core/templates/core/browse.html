{% extends "main.html" %}

{% block content %}

<div class="container card" style="margin-top: 50px;">
    <h2 style="text-align: center;">{{heading}}
      <span class="font-italic text-danger">{{heading_param}}</span></h2>
    <h5 style="text-align: center;">
      <a href="{% url 'recently_deleted' %}">Recently Deleted</a>
    </h5>
    <input class="form-control" id="myInput" type="text" placeholder="Search..">
    <br>
    <table class="table table-hover" id="dtBasicExample">
      <thead>
        <tr>
          <th class="th-sm red">Filename</th>
          {% if showpaddock %} 
            <th class="th-sm red">Paddock</th>
          {% endif %}
          <th class="th-sm red">Year</th>
          <th class="th-sm red">Size</th>
          <th class="th-sm red">Tags</th>
          <th class="th-sm red">Uploaded By</th>
          <th class="th-sm red">Last Edited</th>
          <th class="th-sm red">Action</th>
        </tr>
      </thead>
      <tbody id="myTable">
        {% for file in files %}
          <tr>
              <td><a href="{% url 'file' file.id %}" data-toggle="tooltip" title="View File Info" data-placement="bottom">
                <span class="font-weight-bolder">{{file.name}}</span></a></td>
              <td>
                {% if showpaddock %}  
                  <h5>
                    {% for paddock in file.paddocks.all %}
                      <a href="{% url 'browse' paddock.id %}" data-toggle="tooltip" title="View all files for paddock" data-placement="bottom">
                        <span class="badge badge-light">{{paddock.name}}</span>
                      </a>
                    {% endfor %}
                  </h5>
                {% endif %}
              </td>
              <td>{{file.created|date:'Y'}}</td>
              <td>{{file.filedata.file.size}} Bytes</td>
              <td>
                {% for tag in file.tags.all %}
                  <span class="badge badge-primary">{{tag.name}}</span>
                {% endfor %}
              </td>
              <td><a href="{% url 'profile' file.uploader.id %}" data-toggle="tooltip" title="View Profile" data-placement="bottom">
                {{file.uploader.username}}</a></td>
              <td>{{file.updated}}</td>
              <td>
                <div class="btn-group">
                  <a href="{{ file.filedata.url }}" download data-toggle="tooltip" title="Download" data-placement="bottom">
                    <button type="button" class="btn btn-success">
                      <i class="material-icons" style="font-size:20px;">download</i>
                    </button>
                  </a>
                  <a href="{% url 'update' file.id %}" data-toggle="tooltip" title="Update" data-placement="bottom">
                    <button type="button" class="btn btn-primary">
                      <i class="material-icons" style="font-size:20px;">sync_alt</i>
                    </button>
                  </a>
                  <a href="{% url 'edit' file.id %}" data-toggle="tooltip" title="Edit Details" data-placement="bottom">
                    <button type="button" class="btn btn-info">
                      <i class="material-icons" style="font-size:20px;">assignment</i>
                    </button>
                  </a>
                </div> 
              </td>
          </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th class="th-sm grey">Filename</th>
          {% if showpaddock %} 
            <th class="th-sm grey">Paddock</th>
          {% endif %}
          <th class="th-sm grey">Year</th>
          <th class="th-sm grey">Size</th>
          <th class="th-sm grey">Tags</th>
          <th class="th-sm grey">Uploaded By</th>
          <th class="th-sm grey">Last Edited</th>
          <th class="th-sm grey">Action</th>
        </tr>
      </tfoot>
    </table>
</div>

<script>
    $(document).ready(function(){ 
      $("#myInput").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#myTable tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      });
    });

    // mdb script for datatables
    $(document).ready(function(){
      $('#dtBasicExample').DataTable({searching: false, paging: false});
      $('.dataTables_length').addClass('bs-select');});

      // , info: false

    $(document).ready(function(){
      $('[data-toggle="tooltip"]').tooltip();
    });

    // modifications for search
    $(document).ready(function(){
      $("#myInput").hide();
      $("#myTable tr").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf("{{query}}") > -1)
      });
    });
</script>

{% endblock %}